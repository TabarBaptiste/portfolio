---
import Section from './ui/Section.astro';
import Card from './ui/Card.astro';

// Projets réels
const projects = [
  {
    title: 'Beroli - Application mobile',
    description: 'Application mobile Flutter développée pour optimiser la gestion des interventions terrain d\'une entreprise. Authentification sécurisée, synchronisation en temps réel avec Firebase et interface intuitive pour les techniciens.',
    image: 'https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?w=800&q=80',
    technologies: ['Flutter', 'Dart', 'Firebase'],
    github: 'https://github.com/matbel91765/beroli',
    demo: 'https://www.canva.com/design/DAF-QIOEFEw/Hb1j0QiRgpWCUF9E9B322Q/view?utm_content=DAF-QIOEFEw&utm_campaign=designshare&utm_medium=link2&utm_source=uniquelinks&utlId=hfc5b8fd71e',
    demoLabel: 'Présentation',
    category: 'mobile'
  },
  {
    title: 'Extension VSCode - PHP DAO Generator',
    description: 'Extension VSCode permettant de générer automatiquement des fichiers DAO PHP à partir des attributs d\'une table de base de données. Connexion au serveur via formulaire intégré, génération de code optimisée et monitoring avec Sentry. Disponible sur le marketplace VSCode.',
    image: '/projects/logo.png',
    technologies: ['TypeScript', 'CI/CD', 'Sentry', 'JavaScript', 'MCP', 'Base de données'],
    github: 'https://github.com/TabarBaptiste/dao-generation',
    demo: 'https://marketplace.visualstudio.com/items?itemName=Baptiste-TABAR-LABONNE.php-dao-generator',
    demoLabel: 'Marketplace',
    category: 'web'
  },
  {
    title: 'Aly dous\'heure - Site vitrine',
    description: 'Site vitrine moderne pour une masseuse professionnelle. Système de réservation en ligne, catalogue complet des prestations, visualisation des disponibilités, formulaire de contact et géolocalisation. Interface responsive optimisée pour mobile et desktop.',
    image: 'https://images.unsplash.com/photo-1544161515-4ab6ce6db874?w=800&q=80',
    technologies: ['Astro', 'CI/CD', 'Tailwind CSS', 'JavaScript', 'Référencement SEO'],
    github: 'https://github.com/TabarBaptiste/alydousheure_vitrine',
    demo: 'https://aly-dousheure.netlify.app/',
    demoLabel: 'Voir le site',
    category: 'web'
  },
  {
    title: 'RjWeb - Plateforme communautaire',
    description: 'Plateforme web développée durant mon stage pour centraliser les activités du quartier Lavalle. Inscription aux évènements, newsletter automatisée, gestion des participants et espace administrateur complet.',
    image: '/projects/preview.png',
    technologies: ['PHP', 'JavaScript', 'MySQL', 'HTML', 'CSS'],
    github: 'https://github.com/TabarBaptiste/pyramide',
    demo: null,
    category: 'web',
    screenshots: [
      { name: 'Accueil', path: '/projects/utilisateur.png' },
      { name: 'Connexion', path: '/projects/connexion.png' },
      { name: 'Contact', path: '/projects/contact.png' },
      { name: 'Inscription', path: '/projects/inscription.png' },
      { name: 'Liste inscrits', path: '/projects/inscrit.png' },
      { name: 'Profil', path: '/projects/profil.png' },
      { name: 'À propos', path: '/projects/about.png' }
    ]
  }
];

const categories = ['all', 'web', 'mobile'];
---

<Section 
  id="projects" 
  title="Mes projets"
  subtitle="Une sélection de mes réalisations récentes"
  className="bg-dark-800/30"
>
  <!-- Filtres -->
  <div class="flex flex-wrap justify-center gap-3 mb-12 reveal">
    {categories.map((category) => (
      <button
        class="filter-btn px-6 py-2 rounded-xl glass text-dark-300 hover:text-primary-400 transition-all duration-300 hover:scale-105"
        data-filter={category}
      >
        {category === 'all' ? 'Tous' : category.charAt(0).toUpperCase() + category.slice(1)}
      </button>
    ))}
  </div>

  <!-- Grille de projets -->
  <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="projects-grid">
    {projects.map((project, index) => (
      <div 
        class="reveal project-card" 
        data-category={project.category}
      >
        <Card className="h-full flex flex-col overflow-hidden group">
          <!-- Image -->
          <div class="relative overflow-hidden rounded-xl mb-4 aspect-video">
            <img 
              src={project.image} 
              alt={project.title}
              class={project.image && project.image.includes('logo') ? 'w-full h-full object-contain p-6 bg-white' : 'w-full h-full object-cover transition-transform duration-500 group-hover:scale-110'}
              loading="lazy"
            />
            <div class="absolute inset-0 bg-gradient-to-t from-dark-900 via-dark-900/50 to-transparent opacity-60"></div>
            
            <!-- Overlay avec liens -->
            <div class="absolute inset-0 flex items-center justify-center gap-4 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
              {project.demo && (
                <a 
                  href={project.demo} 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="w-12 h-12 rounded-full bg-primary-500 flex items-center justify-center hover:bg-primary-600 transition-colors shadow-lg"
                  aria-label={project.demoLabel || "Voir la démo"}
                  title={project.demoLabel || "Voir la démo"}
                >
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                  </svg>
                </a>
              )}
              {project.github && (
                <a 
                  href={project.github} 
                  target="_blank"
                  rel="noopener noreferrer"
                  class="w-12 h-12 rounded-full bg-dark-700 flex items-center justify-center hover:bg-dark-600 transition-colors shadow-lg"
                  aria-label="Voir le code source"
                  title="Voir le code sur GitHub"
                >
                  <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                  </svg>
                </a>
              )}
            </div>
          </div>

          <!-- Contenu -->
          <div class="flex-1 flex flex-col">
            <h3 class="text-xl font-bold text-dark-100 mb-2 group-hover:text-primary-400 transition-colors">
              {project.title}
            </h3>
            <p class="text-dark-300 mb-4 flex-1">
              {project.description}
            </p>

            <!-- Technologies -->
            <div class="flex flex-wrap gap-2">
              {project.technologies.map((tech) => (
                <span class="px-3 py-1 rounded-lg bg-dark-800/50 text-primary-400 text-xs border border-dark-700">
                  {tech}
                </span>
              ))}
            </div>
          </div>
        </Card>
      </div>
    ))}
  </div>

  <!-- Message si aucun projet -->
  <div id="no-projects" class="hidden text-center py-12">
    <p class="text-dark-400 text-lg">Aucun projet trouvé dans cette catégorie</p>
  </div>
</Section>

<script>
  // Système de filtrage
  const filterButtons = document.querySelectorAll('.filter-btn');
  const projectCards = document.querySelectorAll<HTMLElement>('.project-card');
  const noProjectsMessage = document.getElementById('no-projects');

  filterButtons.forEach(button => {
    button.addEventListener('click', () => {
      const filter = button.getAttribute('data-filter');
      
      // Mettre à jour l'état actif des boutons
      filterButtons.forEach(btn => {
        btn.classList.remove('bg-primary-500', 'text-white');
        btn.classList.add('text-dark-300');
      });
      button.classList.add('bg-primary-500', 'text-white');
      button.classList.remove('text-dark-300');

      // Filtrer les projets
      let visibleCount = 0;
      projectCards.forEach((card) => {
        const category = card.getAttribute('data-category');
        
        if (filter === 'all' || category === filter) {
          card.style.display = 'block';
          card.style.animationDelay = `${visibleCount * 0.1}s`;
          card.classList.remove('active');
          setTimeout(() => card.classList.add('active'), 10);
          visibleCount++;
        } else {
          card.style.display = 'none';
        }
      });

      // Afficher le message si aucun projet
      if (visibleCount === 0) {
        noProjectsMessage?.classList.remove('hidden');
      } else {
        noProjectsMessage?.classList.add('hidden');
      }
    });
  });

  // Activer le filtre "Tous" par défaut
  const allButton = document.querySelector('[data-filter="all"]');
  allButton?.classList.add('bg-primary-500', 'text-white');
  allButton?.classList.remove('text-dark-300');
</script>