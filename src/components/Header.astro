---
const navItems = [
    { name: "Accueil", href: "/#home" },
    { name: "À propos", href: "/#about" },
    { name: "Expérience", href: "/#experience" },
    { name: "Projets", href: "/#projects" },
    { name: "Compétences", href: "/#skills" },
    // { name: "Veille Tech", href: "/#tech-watch" },
    { name: "Contact", href: "/#contact" },
];
---

<header
    id="header"
    class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
>
    <nav class="max-w-7xl mx-auto px-4 md:px-8 py-4">
        <div class="flex items-center justify-between">
            <!-- Logo -->
            <a
                href="/"
                class="text-2xl font-bold gradient-text hover:scale-110 transition-transform duration-300"
            >
                Portfolio
            </a>

            <!-- Navigation Desktop -->
            <ul class="hidden md:flex items-center space-x-8">
                {
                    navItems.map((item) => (
                        <li>
                            <a
                                href={item.href}
                                class="nav-link text-dark-300 hover:text-primary-400 transition-colors duration-300 relative group"
                                data-section={item.href.split('#')[1]}
                            >
                                {item.name}
                                <span class="nav-indicator absolute bottom-0 left-0 w-0 h-0.5 bg-primary-500 group-hover:w-full transition-all duration-300" />
                            </a>
                        </li>
                    ))
                }
            </ul>

            <div class="flex items-center space-x-3">
                <!-- Bouton Toggle Dark/Light Mode -->
                <button
                    id="theme-toggle-mobile"
                    class="p-2 rounded-xl glass hover:scale-110 transition-all duration-300"
                    aria-label="Toggle theme"
                >
                    <svg
                        id="theme-icon-sun-mobile"
                        class="w-5 h-5 hidden"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                        ></path>
                    </svg>
                    <svg
                        id="theme-icon-moon-mobile"
                        class="w-5 h-5"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"
                        ></path>
                    </svg>
                </button>

                <!-- Bouton Menu Mobile -->
                <button
                    id="mobile-menu-button"
                    class="md:hidden text-dark-100 focus:outline-none"
                    aria-label="Menu"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            id="menu-icon"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Menu Mobile -->
        <div
            id="mobile-menu"
            class="md:hidden hidden mt-4 glass rounded-2xl p-4 animate-fade-down"
        >
            <ul class="space-y-3">
                {
                    navItems.map((item) => (
                        <li>
                            <a
                                href={item.href}
                                class="block text-dark-200 hover:text-primary-400 transition-colors duration-300 py-2 px-4 rounded-xl hover:bg-dark-800/50"
                            >
                                {item.name}
                            </a>
                        </li>
                    ))
                }
            </ul>
        </div>
    </nav>
</header>

<script>
    // Effet de transparence au scroll
    const header = document.getElementById("header");
    // let lastScroll = 0;

    window.addEventListener("scroll", () => {
        const currentScroll = window.pageYOffset;

        if (currentScroll > 100) {
            header?.classList.add("glass", "shadow-lg");
        } else {
            header?.classList.remove("glass", "shadow-lg");
        }

        // lastScroll = currentScroll;
    });

    // Toggle menu mobile
    const mobileMenuButton = document.getElementById("mobile-menu-button");
    const mobileMenu = document.getElementById("mobile-menu");
    const menuIcon = document.getElementById("menu-icon");

    mobileMenuButton?.addEventListener("click", () => {
        mobileMenu?.classList.toggle("hidden");

        // Animation de l'icône
        if (mobileMenu?.classList.contains("hidden")) {
            menuIcon?.setAttribute("d", "M4 6h16M4 12h16M4 18h16");
        } else {
            menuIcon?.setAttribute("d", "M6 18L18 6M6 6l12 12");
        }
    });

    // Fermer le menu mobile au clic sur un lien
    const mobileLinks = mobileMenu?.querySelectorAll("a");
    mobileLinks?.forEach((link) => {
        link.addEventListener("click", () => {
            mobileMenu?.classList.add("hidden");
            menuIcon?.setAttribute("d", "M4 6h16M4 12h16M4 18h16");
        });
    });

    // Gestion du thème (dark/light mode)
    const themeToggle = document.getElementById("theme-toggle");
    const themeToggleMobile = document.getElementById("theme-toggle-mobile");
    const sunIcon = document.getElementById("theme-icon-sun");
    const moonIcon = document.getElementById("theme-icon-moon");
    const sunIconMobile = document.getElementById("theme-icon-sun-mobile");
    const moonIconMobile = document.getElementById("theme-icon-moon-mobile");

    // Fonction pour mettre à jour les icônes
    const updateThemeIcons = (isDark: boolean) => {
        if (isDark) {
            sunIcon?.classList.add("hidden");
            moonIcon?.classList.remove("hidden");
            sunIconMobile?.classList.add("hidden");
            moonIconMobile?.classList.remove("hidden");
        } else {
            sunIcon?.classList.remove("hidden");
            moonIcon?.classList.add("hidden");
            sunIconMobile?.classList.remove("hidden");
            moonIconMobile?.classList.add("hidden");
        }
    };

    // Fonction pour basculer le thème
    const toggleTheme = () => {
        const html = document.documentElement;
        const isDark = html.classList.contains("dark");

        if (isDark) {
            html.classList.remove("dark");
            localStorage.setItem("theme", "light");
            updateThemeIcons(false);
        } else {
            html.classList.add("dark");
            localStorage.setItem("theme", "dark");
            updateThemeIcons(true);
        }
    };

    // Initialiser le thème au chargement
    const initTheme = () => {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
            "(prefers-color-scheme: dark)",
        ).matches;
        const isDark = savedTheme === "dark" || (!savedTheme && prefersDark);

        if (isDark) {
            document.documentElement.classList.add("dark");
        } else {
            document.documentElement.classList.remove("dark");
        }
        updateThemeIcons(isDark);
    };

    // Initialiser au chargement
    initTheme();

    // Ajouter les event listeners
    themeToggle?.addEventListener("click", toggleTheme);
    themeToggleMobile?.addEventListener("click", toggleTheme);

    // Navigation active - détection de section visible
    const navLinks = document.querySelectorAll('.nav-link');
    const navIndicators = document.querySelectorAll('.nav-indicator');
    let currentSection = '';

    // Fonction pour mettre à jour la navigation active
    const updateActiveNav = (sectionId: string) => {
        if (currentSection === sectionId) return;
        currentSection = sectionId;

        navLinks.forEach((link, index) => {
            const linkElement = link as HTMLElement;
            const indicator = navIndicators[index] as HTMLElement;
            const section = linkElement.getAttribute('data-section');

            if (section === sectionId) {
                linkElement.classList.add('text-primary-400');
                linkElement.classList.remove('text-dark-300');
                indicator.classList.add('w-full');
                indicator.classList.remove('group-hover:w-full');
            } else {
                linkElement.classList.remove('text-primary-400');
                linkElement.classList.add('text-dark-300');
                indicator.classList.remove('w-full');
                indicator.classList.add('group-hover:w-full');
            }
        });
    };

    // Observer pour détecter les sections visibles
    const sectionObserver = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    const sectionId = entry.target.id;
                    updateActiveNav(sectionId);
                }
            });
        },
        {
            rootMargin: '-50% 0px -50% 0px', // Active quand la section est au centre
            threshold: 0
        }
    );

    // Observer toutes les sections
    const sections = document.querySelectorAll('section[id]');
    sections.forEach((section) => {
        sectionObserver.observe(section);
    });

    // Gestion du clic sur les liens de navigation
    navLinks.forEach((link) => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const href = link.getAttribute('href');
            if (href) {
                const targetId = href.split('#')[1];
                const targetElement = document.getElementById(targetId);
                if (targetElement) {
                    const headerHeight = header?.offsetHeight || 0;
                    const targetPosition = targetElement.offsetTop - headerHeight - 20;

                    window.scrollTo({
                        top: targetPosition,
                        behavior: 'smooth'
                    });
                }
            }
        });
    });

    // Mettre à jour la navigation au chargement de la page
    const updateNavOnLoad = () => {
        const hash = window.location.hash.slice(1);
        if (hash) {
            updateActiveNav(hash);
        } else {
            // Si pas de hash, vérifier quelle section est visible au chargement
            const firstVisibleSection = Array.from(sections).find((section) => {
                const rect = section.getBoundingClientRect();
                return rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2;
            });
            if (firstVisibleSection) {
                updateActiveNav(firstVisibleSection.id);
            }
        }
    };

    // Mettre à jour au chargement et au changement de hash
    window.addEventListener('load', updateNavOnLoad);
    window.addEventListener('hashchange', () => {
        const hash = window.location.hash.slice(1);
        updateActiveNav(hash);
    });
</script>

<style>
    .nav-link.active {
        @apply text-primary-400;
    }
    
    .nav-link.active .nav-indicator {
        @apply w-full;
    }
</style>
